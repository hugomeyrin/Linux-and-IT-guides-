1. Installer Ansible sur le serveur de gestion

Sur une machine Debian (ou Ubuntu) d√©di√©e comme contr√¥leur Ansible :

bash

sudo apt update
sudo apt install ansible -y

V√©rifiez l‚Äôinstallation :

bash

ansible --version

2. Configurer les h√¥tes cibles (machines Debian desktop)

    Sur chaque machine cible, assurez-vous que SSH est activ√© et que vous pouvez vous y connecter depuis le serveur Ansible.
    Installez Python (n√©cessaire pour Ansible) :

    bash

    sudo apt install python3 -y

3. Cr√©er un fichier d‚Äôinventaire (hosts)

Exemple : /etc/ansible/hosts ou ~/ansible/inventory.ini

ini

[debian_desktops]
host1 ansible_host=192.168.1.10
host2 ansible_host=192.168.1.11
...
host100 ansible_host=192.168.1.100

[debian_desktops:vars]
ansible_user=votre_utilisateur
ansible_ssh_private_key_file=~/.ssh/id_rsa
ansible_python_interpreter=/usr/bin/python3

    ‚úÖ Vous pouvez aussi utiliser des groupes, des variables, ou un inventaire dynamique si les machines sont dans un r√©seau g√©r√© (ex: via un script ou un CMDB).

4. Tester la connexion

bash

ansible -i ~/ansible/inventory.ini debian_desktops -m ping

Si tout fonctionne, vous devriez voir un SUCCESS pour chaque machine.
5. Cr√©er des playbooks pour la gestion du parc

Exemple simple : update_all.yml

yaml

---
- name: Mettre √† jour tous les paquets Debian
  hosts: debian_desktops
  become: yes
  tasks:
    - name: Mettre √† jour la liste des paquets
      apt:
        update_cache: yes

    - name: Mettre √† jour les paquets
      apt:
        upgrade: dist
        autoremove: yes

Ex√©cuter :

bash

ansible-playbook -i ~/ansible/inventory.ini update_all.yml

6. Bonnes pratiques pour 100 machines

    Utilisez --forks pour parall√©liser les t√¢ches :

    bash

    ansible-playbook -i inventory.ini update_all.yml --forks 20

    Utilisez des tags pour cibler des t√¢ches sp√©cifiques.
    Activez le logging ou utilisez ansible-playbook --check en mode dry-run.
    S√©curisez les cl√©s SSH et utilisez un utilisateur d√©di√© (ex: ansible).
    Automatisez avec cron ou un scheduler si n√©cessaire.

7. Optionnel : Utiliser AWX ou Tower (pour une interface graphique)

Si vous voulez une interface web pour g√©rer le parc, installez AWX (version open-source d‚ÄôAnsible Tower) ‚Äî mais cela n√©cessite plus de ressources.

‚úÖ Vous √™tes maintenant pr√™t √† g√©rer votre parc de 100 machines Debian desktop avec Ansible.

Besoin d‚Äôun playbook sp√©cifique (ex: installer un logiciel, configurer un firewall, cr√©er des utilisateurs) ? Dites-le-moi.


-----------------------------------------------------------------------------------------------------------------------------------------------------------


Pour g√©rer un parc de machines Debian desktop via SSH, vous pouvez utiliser Ansible (comme mentionn√© pr√©c√©demment) ou des outils plus l√©gers comme SSH + scripts shell + boucles. Voici les deux approches, adapt√©es √† votre besoin.
‚úÖ Option 1 : Gestion via Ansible (recommand√© pour 100 machines)
Pr√©requis sur chaque machine Debian desktop :

    SSH activ√© (sudo systemctl enable ssh && sudo systemctl start ssh)
    Utilisateur avec acc√®s SSH (ex: vitor ou ansible)
    Cl√© SSH d√©ploy√©e sur le serveur de gestion
    Python3 install√© : sudo apt install python3 -y

√âtapes r√©sum√©es :

    Installer Ansible sur le serveur de gestion (une machine Debian/Ubuntu).
    Cr√©er un inventaire (inventory.ini) listant les 100 machines.
    Tester la connexion : ansible -i inventory.ini all -m ping
    √âcrire des playbooks pour :
        Mettre √† jour les paquets
        Installer des logiciels
        G√©rer les utilisateurs
        Configurer le firewall, etc.

    üìå Exemple de playbook pour installer un logiciel :

yaml

---
- name: Installer Firefox sur toutes les machines
  hosts: debian_desktops
  become: yes
  tasks:
    - name: Installer Firefox
      apt:
        name: firefox
        state: present

‚úÖ Option 2 : Gestion via SSH + scripts shell (plus simple, mais moins scalable)
Pr√©requis :

    Cl√© SSH d√©ploy√©e sur toutes les machines
    Liste des IPs ou noms d‚Äôh√¥tes dans un fichier (ex: hosts.txt)

Exemple de script shell :

bash

#!/bin/bash
while read host; do
  echo "=== $host ==="
  ssh -o StrictHostKeyChecking=no user@$host "sudo apt update && sudo apt upgrade -y"
done < hosts.txt

    ‚ö†Ô∏è Attention : ce script ne g√®re pas les erreurs, ni la parall√©lisation. Pour 100 machines, il sera lent.

Pour parall√©liser :

Utilisez parallel :

bash

apt install parallel -y
cat hosts.txt | parallel -j 10 ssh -o StrictHostKeyChecking=no user@{} "sudo apt update && sudo apt upgrade -y"

üîê S√©curit√© recommand√©e

    Utilisez un utilisateur d√©di√© (ex: ansible) sans mot de passe, avec cl√© SSH.
    Limitez les droits avec sudoers :

    bash

    ansible ALL=(ALL) NOPASSWD: /usr/bin/apt, /usr/bin/systemctl, etc.

    D√©sactivez la connexion root par SSH (PermitRootLogin no dans /etc/ssh/sshd_config).

üìä Pour 100 machines : privil√©giez Ansible

Ansible est con√ßu pour cela :

    Parall√©lisation native (--forks)
    Idempotence (les playbooks peuvent √™tre r√©ex√©cut√©s sans effet secondaire)
    Gestion des erreurs
    Journalisation
    Modules avanc√©s (packages, services, fichiers, utilisateurs, etc.)

